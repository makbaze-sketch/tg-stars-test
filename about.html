<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Qleweta ‚Äî –°—Ç–∞—Ç—É—Å & –ü–µ—Å–æ—á–Ω–∏—Ü–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="color-scheme" content="dark light">
<style>
  :root{
    --bg:#000; --card:#111; --stroke:#222; --text:#F3F4F8; --muted:#A8AAB6;
    --accent:#7C5CFF; --accent2:#00D1FF; --ok:#73FFBF; --warn:#FFD166;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto;}
  .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;padding:18px 12px 84px}
  .card{width:min(1000px,98vw);margin:0 auto;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--stroke);border-radius:22px;padding:16px;backdrop-filter:blur(8px)}
  .head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
  .title{display:flex;align-items:center;gap:12px}
  .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 0deg,var(--accent),var(--accent2),var(--accent))}
  h1{margin:0;font-size:22px}.sub{margin:4px 0 0;color:var(--muted);font-size:14px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:#0f1015aa}
  .badge.warn{border-color:rgba(255,209,102,.4);background:rgba(255,209,102,.08)}

  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 12px}
  .tab{border:1px solid var(--stroke);background:#14151b;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
  .tab.active{outline:2px solid rgba(124,92,255,.45)}
  .section{display:none}.section.active{display:block}

  .grid{display:grid;gap:12px}
  .block{border:1px solid var(--stroke);border-radius:16px;background:#0f1015;padding:14px}
  .block h3{margin:0 0 8px;font-size:16px}
  .list{display:grid;gap:10px;margin-top:6px}
  .row{display:flex;gap:10px;align-items:flex-start}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--accent2);margin-top:8px;box-shadow:0 0 10px var(--accent2)}
  .kv{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .kv .item{border:1px solid var(--stroke);border-radius:12px;background:#12141a;padding:10px}

  .footer{position:fixed;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);backdrop-filter:blur(8px);border-top:1px solid var(--stroke);padding:10px 12px;display:flex;justify-content:center}
  .btn{border:1px solid var(--stroke);background:#1b1c22;color:var(--text);border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
  .btn.primary{border-color:rgba(124,92,255,.45)}

  .canvas-wrap{position:relative;border:1px solid #0d1420;border-radius:16px;overflow:hidden;background:#000}
  canvas{display:block;width:100%;height:420px}
  .hint{position:absolute;right:10px;top:10px;font-size:12px;color:#6cf;background:rgba(8,20,40,.6);padding:6px 10px;border-radius:999px;border:1px solid #153055}

  .mini-tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 10px}
  .mini-tabs .chip{border:1px solid var(--stroke);background:#161820;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700}
  .mini-tabs .chip.active{outline:2px solid rgba(0,200,255,.45)}

  /* ChatGPT scene text + CRT */
  .chat-text{
    position:absolute; inset:0; display:grid; place-items:center; pointer-events:auto;
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    color:#00ffd0; text-shadow:0 0 8px #00ffaa; text-align:center; white-space:pre-line;
    padding:16px;
  }
  .line{font-size:18px}
  .cursor{display:inline-block;width:8px;background:#00ffd0;margin-left:4px;animation:blink .8s steps(1,end) infinite}
  @keyframes blink{50%{opacity:0}}
  .crt{
    position:absolute; inset:0; pointer-events:none; mix-blend-mode:screen;
    background:repeating-linear-gradient(0deg, rgba(255,255,255,.04), rgba(255,255,255,.04) 1px, transparent 2px, transparent 3px);
    opacity:.06; animation:flicker 2.4s ease-in-out infinite;
  }
  @keyframes flicker{ 0%,100%{opacity:.05} 50%{opacity:.09} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="title">
          <div class="logo"></div>
          <div>
            <h1>Qleweta ‚Äî –°—Ç–∞—Ç—É—Å & –ü–µ—Å–æ—á–Ω–∏—Ü–∞</h1>
            <p class="sub">–ë–∞–∑–∞ —É–∂–µ –∂–∏–≤–∞—è, –∫—Ä–∞—Å–æ—Ç—É –¥–æ–∫—Ä—É—á–∏–≤–∞–µ–º ‚ú®</p>
          </div>
        </div>
        <div class="badges">
          <span class="badge warn">Beta</span>
          <span class="badge">–í–µ—Ä—Å–∏—è: 0.4</span>
          <span class="badge">–û–±–Ω–æ–≤–ª–µ–Ω–æ: —Å–µ–≥–æ–¥–Ω—è</span>
        </div>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="t1">–°—Ç–∞—Ç—É—Å</div>
        <div class="tab" data-tab="t2">–ö–∞–∫ —Å–¥–µ–ª–∞–Ω–æ</div>
        <div class="tab" data-tab="t3">–ü–µ—Å–æ—á–Ω–∏—Ü–∞</div>
      </div>

      <!-- ========== –°—Ç–∞—Ç—É—Å -->
      <section id="t1" class="section active">
        <div class="grid">
          <div class="block">
            <h3>–ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
            <div class="list">
              <div class="row"><div class="dot"></div><div>–û—Ç–∫—Ä—ã—Ç–∏–µ WebApp –∏–∑ –±–æ—Ç–∞ (–º–∞–≥–∞–∑–∏–Ω –∏ –∏–Ω—Ñ–æ-–∞–ø–ø)</div></div>
              <div class="row"><div class="dot"></div><div>–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –∏–∑ WebApp ‚Üí –∏–Ω–≤–æ–π—Å Stars –≤ —á–∞—Ç (–∞–Ω—Ç–∏-–¥—É–±–ª–∏)</div></div>
              <div class="row"><div class="dot"></div><div>–ü—Ä–æ—Ñ–∏–ª—å: —Å—É–º–º–∞—Ä–Ω—ã–µ –∑–≤—ë–∑–¥—ã –∏ —É—Ä–æ–≤–µ–Ω—å (Free ‚Üí Mini ‚Üí Plus ‚Üí Ultra)</div></div>
              <div class="row"><div class="dot"></div><div>–ß–∏—Å—Ç—ã–π —á–∞—Ç: —É–¥–∞–ª—è–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ª–∏—à–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</div></div>
            </div>
          </div>

          <div class="block">
            <h3>–í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å</h3>
            <div class="kv">
              <div class="item"><b>Beta-—Ä–µ–∂–∏–º</b><br><span style="color:#A8AAB6">–í–æ–∑–º–æ–∂–Ω—ã –±–∞–≥–∏ –∏ –º–∏–∫—Ä–æ-–∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –≤—ã–¥–∞—á–µ –∏–Ω–≤–æ–π—Å–∞.</span></div>
              <div class="item"><b>–û–ø–ª–∞—Ç—ã Stars</b><br><span style="color:#A8AAB6">–ü–æ–∫—É–ø–∫–∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Telegram.</span></div>
              <div class="item"><b>UX iOS/–ü–ö</b><br><span style="color:#A8AAB6">–ú–∏–Ω–∏-–∞–ø–ø –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —á–∞—Ç –±–µ–∑ –¥–∏–ø-–ª–∏–Ω–∫–æ–≤.</span></div>
            </div>
          </div>

          <div class="block">
            <h3>–î–∏—Å–∫–ª–µ–π–º–µ—Ä</h3>
            <div class="list">
              <div class="row"><div class="dot"></div><div>–ú—ã –Ω–µ –æ—Ç–≤–µ—á–∞–µ–º –∑–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</div></div>
              <div class="row"><div class="dot"></div><div>–ò—Å–ø–æ–ª—å–∑—É—è –±–æ—Ç–∞, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —ç—Ç–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –∏ –∑–∞–∫–æ–Ω–∞–º–∏ –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.</div></div>
            </div>
          </div>

          <div class="block">
            <h3>–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞</h3>
            <div class="kv">
              <div class="item"><b>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</b><br><span class="muted">–∫—Ä–∞—Ç–∫–∞—è –≤—ã–ø–∏—Å–∫–∞ –≤ /info</span></div>
              <div class="item"><b>–†–µ—Ñ–µ—Ä–∞–ª—ã</b><br><span class="muted">–±–æ–Ω—É—Å—ã –∑–≤—ë–∑–¥–∞–º–∏</span></div>
              <div class="item"><b>–ï—â—ë –ø–∞–∫–µ—Ç—ã</b><br><span class="muted">–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É—Å—Ç—ã, —Ä–æ–ª–∏</span></div>
              <div class="item"><b>UI-—Ç–µ–º—ã</b><br><span class="muted">Glow/Neon/Mono</span></div>
            </div>
          </div>

          <div class="block">
            <h3>–ö–æ–Ω—Ç–∞–∫—Ç</h3>
            <p class="muted" style="margin:6px 0 0">–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –≤ —á–∞—Ç –±–æ—Ç—É. –ú—ã –≤–∏–¥–∏–º –ª–æ–≥–∏ –∏ –æ—Ç–≤–µ—á–∞–µ–º –±—ã—Å—Ç—Ä–æ.</p>
          </div>
        </div>
      </section>

      <!-- ========== –ö–∞–∫ —Å–¥–µ–ª–∞–Ω–æ -->
      <section id="t2" class="section">
        <div class="grid">
          <div class="block">
            <h3>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h3>
            <div class="list">
              <div class="row"><div class="dot"></div><div><b>–ë–æ—Ç:</b> aiogram v3 + SQLite, –∞–Ω—Ç–∏-–¥—É–±–ª–∏ –∏–Ω–≤–æ–π—Å–æ–≤/–∏–Ω—Ñ–æ, —á–∏—Å—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–∫.</div></div>
              <div class="row"><div class="dot"></div><div><b>WebApp:</b> –≤–∞–Ω–∏–ª—å–Ω—ã–π HTML/CSS/JS, –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫, –∞–¥–∞–ø—Ç–∏–≤, glow-—Å—Ç–∏–ª—å.</div></div>
              <div class="row"><div class="dot"></div><div><b>UX –æ–ø–ª–∞—Ç—ã:</b> <code>sendData ‚Üí close()</code> –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —á–∞—Ç.</div></div>
            </div>
          </div>
          <div class="block">
            <h3>–ò–¥–µ—è</h3>
            <p class="muted" style="margin:6px 0 0">–°–æ–±—Ä–∞–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ ChatGPT ‚Äî –æ—Ç –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –¥–æ –¥–∏–∑–∞–π–Ω–∞. –°—Ç–∞–≤–∏–º –ø—Ä–æ—Å—Ç–æ—Ç—É –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã—à–µ ¬´–ª–∏—à–Ω–µ–π –º–∞–≥–∏–∏¬ª.</p>
          </div>
        </div>
      </section>

      <!-- ========== –ü–µ—Å–æ—á–Ω–∏—Ü–∞ -->
      <section id="t3" class="section">
        <div class="block">
          <h3>–ò–≥—Ä–æ–≤–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞</h3>
          <div class="mini-tabs">
            <div class="chip active" data-s="chatgpt">ü§ñ ChatGPT Scene</div>
            <div class="chip" data-s="eyes">üëÄ Eyes</div>
            <div class="chip" data-s="parts">‚ú® Particles</div>
          </div>

          <!-- CHATGPT -->
          <div class="canvas-wrap scene" id="scene-chatgpt">
            <canvas id="chat"></canvas>
            <div class="chat-text" id="chatText">
              <div class="line" id="l1"></div>
              <div class="line" id="l2"></div>
            </div>
            <div class="crt"></div>
            <div class="hint">—Ç–∞–ø–Ω–∏/–∫–ª–∏–∫–Ω–∏ –ø–æ —ç–∫—Ä–∞–Ω—É</div>
          </div>

          <!-- EYES -->
          <div class="canvas-wrap scene" id="scene-eyes" style="display:none">
            <canvas id="eyes"></canvas>
            <div class="hint">—Ç–∞–ø–Ω–∏ –ø–æ –≥–ª–∞–∑—É ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç</div>
          </div>

          <!-- PARTICLES -->
          <div class="canvas-wrap scene" id="scene-parts" style="display:none">
            <canvas id="parts"></canvas>
            <div class="hint">—Ç–∞–ø ‚Äî —Å–ø–∞–≤–Ω —á–∞—Å—Ç–∏—Ü ‚Ä¢ –∫—É—Ä—Å–æ—Ä –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç</div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="footer"><button class="btn primary" id="closeBtn">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç–∞</button></div>

<script>
  // Telegram init
  if (window.Telegram?.WebApp){ Telegram.WebApp.ready(); Telegram.WebApp.expand(); }

  // Tabs (–≤–µ—Ä—Ö–Ω–∏–µ)
  const tabs = document.querySelectorAll('.tab');
  const sections = document.querySelectorAll('.section');
  tabs.forEach(t=>t.addEventListener('click',()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    sections.forEach(s=>s.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
    try{Telegram.WebApp?.HapticFeedback?.impactOccurred('light');}catch(e){}
  }));

  // Close
  document.getElementById('closeBtn').onclick = ()=>{ try{ Telegram.WebApp.close(); }catch(e){} };

  // ------------------ –ü–ï–°–û–ß–ù–ò–¶–´: –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
  const chips = document.querySelectorAll('.chip');
  const scenes = {
    chatgpt: document.getElementById('scene-chatgpt'),
    eyes: document.getElementById('scene-eyes'),
    parts: document.getElementById('scene-parts'),
  };
  chips.forEach(ch=>{
    ch.addEventListener('click', ()=>{
      chips.forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');
      Object.values(scenes).forEach(el=>el.style.display='none');
      const id = ch.dataset.s;
      scenes[id].style.display = '';
      if (id==='chatgpt') startChatGPT();
      if (id==='eyes') startEyes();
      if (id==='parts') startParts();
    });
  });

  // ================== CHATGPT SCENE ==================
  let chatStarted=false;
  function startChatGPT(){
    if(chatStarted) return; chatStarted=true;

    const c=document.getElementById('chat'), ctx=c.getContext('2d');
    function resize(){
      const box=c.parentElement, W=box.clientWidth, H=420;
      c.width=W*devicePixelRatio; c.height=H*devicePixelRatio;
      c.style.width=W+"px"; c.style.height=H+"px";
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    resize(); addEventListener('resize', resize);

    // glow background
    let t=0;
    function loop(){
      t+=0.015;
      const W=c.width/devicePixelRatio, H=c.height/devicePixelRatio;
      const r=60+Math.sin(t)*25, R=360;
      const gx=W/2 + Math.sin(t*0.7)*40, gy=H/2 + Math.cos(t*0.6)*24;
      const grd=ctx.createRadialGradient(gx,gy,r, W/2,H/2,R);
      grd.addColorStop(0, "rgba(0,255,210,0.32)");
      grd.addColorStop(0.45, "rgba(0,140,200,0.15)");
      grd.addColorStop(1, "rgba(0,0,0,1)");
      ctx.fillStyle=grd; ctx.fillRect(0,0,W,H);
      requestAnimationFrame(loop);
    }
    loop();

    // typewriter
    const l1=document.getElementById('l1');
    const l2=document.getElementById('l2');
    const msg1="üëã –ü—Ä–∏–≤–µ—Ç! –Ø ChatGPT. –ù–∞–∂–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî –æ—Ç–≤–µ—á—É";
    const msg2="–ê—Ö–∞—Ö–∞—Ö üòÜ –Ω—É —Ç—ã —á—ë, –ø–æ–≤–µ—Ä–∏–ª?\nAPI –¥–æ—Ä–æ–≥–∏–µ —Å–µ–π—á–∞—Å, –±—Ä–æ üí∏";
    let clicked=false;

    function typeLine(el, text, speed=22, done){
      el.innerHTML=""; let i=0;
      const spanCursor = document.createElement('span'); spanCursor.className='cursor';
      const tick=()=> {
        if(i<text.length){
          el.textContent += text[i++];
          if(i%3===0){ try{Telegram.WebApp?.HapticFeedback?.impactOccurred('light');}catch(e){} }
          setTimeout(tick, speed);
        } else {
          el.appendChild(spanCursor);
          if(done) done();
        }
      };
      tick();
    }
    typeLine(l1, msg1, 18);

    function trigger(){
      if(clicked) return; clicked=true;
      const wrap=document.getElementById('chatText');
      wrap.style.color="#ff66aa";
      wrap.style.textShadow="0 0 12px #ff66aa, 0 0 28px rgba(255,102,170,.35)";

      l1.innerHTML=""; l2.innerHTML="";
      typeLine(l1, "–û—Ç–≤–µ—Ç:", 28, ()=>{
        typeLine(l2, msg2, 14);
      });
    }

    document.getElementById('chatText').addEventListener('click', trigger);
    c.addEventListener('click', trigger);
    document.getElementById('chatText').addEventListener('touchstart', e=>{e.preventDefault(); trigger();},{passive:false});
    c.addEventListener('touchstart', e=>{e.preventDefault(); trigger();},{passive:false});
  }
  startChatGPT(); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–Ω–∞

  // ================== EYES ==================
  let eyesStarted=false;
  function startEyes(){
    if(eyesStarted) return; eyesStarted=true;
    const c=document.getElementById('eyes'), ctx=c.getContext('2d');
    let W=0,H=0,dpr=1;
    function resize(){
      const box=c.parentElement;W=box.clientWidth;H=420;
      dpr=Math.max(1,Math.min(2,devicePixelRatio||1));
      c.width=Math.floor(W*dpr);c.height=Math.floor(H*dpr);
      c.style.width=W+"px";c.style.height=H+"px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    resize(); addEventListener('resize',resize);

    const eyes=[{x:W*0.38,y:H*0.5,r:62, iris:"#66ccff"},{x:W*0.62,y:H*0.5,r:62, iris:"#66ccff"}];
    function randColor(){ return `hsl(${(Math.random()*360)|0},90%,60%)`; }

    let mx=W/2,my=H/2,active=false;
    function setMouse(e){ const r=c.getBoundingClientRect(); const p=('touches'in e)?e.touches[0]:e; mx=p.clientX-r.left; my=p.clientY-r.top; active=true; }
    function clearMouse(){ active=false; }
    c.addEventListener('mousemove',setMouse); c.addEventListener('mouseleave',clearMouse);
    c.addEventListener('touchstart',setMouse,{passive:false}); c.addEventListener('touchmove',setMouse,{passive:false}); addEventListener('touchend',clearMouse);
    c.addEventListener('click', (e)=>{ const r=c.getBoundingClientRect(); const x=e.clientX-r.left, y=e.clientY-r.top;
      for(const eye of eyes){ if (Math.hypot(x-eye.x,y-eye.y)<=eye.r) eye.iris=randColor(); } });

    function drawEye(eye){
      const {x,y,r,iris}=eye;
      ctx.shadowBlur=18; ctx.shadowColor="rgba(180,200,255,.35)";
      ctx.fillStyle="#0b0f18"; ctx.strokeStyle="#2a2f3a"; ctx.lineWidth=2;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); ctx.stroke();

      const dx=mx-x, dy=my-y, dist=Math.hypot(dx,dy);
      const lim = r*0.45;
      const px = x + (dist>lim ? dx/dist*lim : dx);
      const py = y + (dist>lim ? dy/dist*lim : dy);

      ctx.shadowBlur=20; ctx.shadowColor=iris; ctx.fillStyle=iris;
      ctx.beginPath(); ctx.arc(px,py,r*0.36,0,Math.PI*2); ctx.fill();

      ctx.shadowBlur=10; ctx.shadowColor="#000"; ctx.fillStyle="#000";
      ctx.beginPath(); ctx.arc(px,py,r*0.18,0,Math.PI*2); ctx.fill();

      ctx.shadowBlur=0; ctx.fillStyle="rgba(255,255,255,.9)";
      ctx.beginPath(); ctx.arc(px-r*0.1,py-r*0.1,r*0.06,0,Math.PI*2); ctx.fill();
    }

    function loop(){
      eyes[0].x=W*0.38; eyes[0].y=H*0.5; eyes[1].x=W*0.62; eyes[1].y=H*0.5;
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
      for(const e of eyes) drawEye(e);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  }

  // ================== PARTICLES ==================
  let partsStarted=false;
  function startParts(){
    if(partsStarted) return; partsStarted=true;
    const c=document.getElementById('parts'), ctx=c.getContext('2d');
    let W=0,H=0,dpr=1;
    function resize(){
      const box=c.parentElement;W=box.clientWidth;H=420;
      dpr=Math.max(1,Math.min(2,devicePixelRatio||1));
      c.width=Math.floor(W*dpr);c.height=Math.floor(H*dpr);
      c.style.width=W+"px";c.style.height=H+"px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    resize(); addEventListener('resize',resize);

    const P=[];
    function spawn(x,y,n=16){
      for(let i=0;i<n;i++){
        const a=Math.random()*Math.PI*2;
        const v=40+Math.random()*140;
        P.push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,r:2+Math.random()*3,h:(Math.random()*360)|0,life:2});
      }
    }
    spawn(W/2,H/2,28);

    let mx=W/2,my=H/2,active=false;
    function setMouse(e){ const r=c.getBoundingClientRect(); const p=('touches'in e)?e.touches[0]:e; mx=p.clientX-r.left; my=p.clientY-r.top; active=true; }
    function clearMouse(){ active=false; }
    c.addEventListener('mousemove',setMouse); c.addEventListener('mouseleave',clearMouse);
    c.addEventListener('touchstart',setMouse,{passive:false}); c.addEventListener('touchmove',setMouse,{passive:false}); addEventListener('touchend',clearMouse);
    c.addEventListener('click',e=>{ const r=c.getBoundingClientRect(); spawn(e.clientX-r.left,e.clientY-r.top,20); });

    let last=performance.now();
    function loop(now){
      const dt=Math.min(40,now-last)/1000; last=now;
      ctx.fillStyle="rgba(0,0,0,0.25)"; ctx.fillRect(0,0,W,H);

      for(const p of P){
        if(active){
          const dx=mx-p.x, dy=my-p.y, d=Math.hypot(dx,dy)+1;
          const f=120/d; p.vx+=dx/d*f*dt; p.vy+=dy/d*f*dt;
        }
        p.vx*=0.99; p.vy*=0.99;
        p.x+=p.vx*dt; p.y+=p.vy*dt;
        if(p.x<0||p.x>W) p.vx*=-1;
        if(p.y<0||p.y>H) p.vy*=-1;

        p.life-=dt*0.25;

        ctx.shadowBlur=14; ctx.shadowColor=`hsla(${p.h},100%,60%,.9)`;
        ctx.fillStyle=`hsla(${p.h},95%,60%,.9)`;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      }
      for(let i=P.length-1;i>=0;i--) if(P[i].life<=0) P.splice(i,1);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  }
</script>
</body>
</html>
