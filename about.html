<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <!-- –ü–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è; –∑–∞–ø—Ä–µ—â–∞–µ–º –∑—É–º, —É—á–∏—Ç—ã–≤–∞–µ–º safe-area -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark light"/>
  <title>Qleweta ‚Äî –ú–∏–Ω–∏‚Äë–∞–ø–ø (Production)</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
  /* =====================================================================
     QLEWETA MINI‚ÄëAPP ‚Äî MOBILE PRO v2 (Production‚Äëready, single file)
     ---------------------------------------------------------------------
     –¶–µ–ª–∏ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:
       ‚Ä¢ –£–±—Ä–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥ ‚Äî –æ–¥–∏–Ω –±–∞–∑–æ–≤—ã–π —è–∑—ã–∫ (RU). –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ç–∏—á–Ω—ã.
       ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã: bottom‚Äënav, –∫—Ä—É–ø–Ω—ã–µ —Ö–∏—Ç—ã,
         safe‚Äëarea, –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å, –ø–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (—Å —É—á—ë—Ç–æ–º reduced‚Äëmotion).
       ‚Ä¢ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è ¬´–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫¬ª: –ª–æ–∫–∞–ª—å–Ω–æ–µ/–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å
         —ç–∫—Å–ø–æ—Ä—Ç–æ–º/–∏–º–ø–æ—Ä—Ç–æ–º, –æ—á–∏—Å—Ç–∫–æ–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
       ‚Ä¢ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∏—Ç–∫–∏ ¬´–û–±—ä–µ–∫—Ç¬ª: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∏–∑
         initDataUnsafe (–ø—Ä–µ–º–∏—É–º, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —Ç–µ–º–∞, –≤–µ—Ä—Å–∏—è –∏ —Ç.–ø.).
       ‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ FAQ: –ø—Ä–∏ —Ç–∞–ø–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∞—Ç—å—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
       ‚Ä¢ –£—Å–∏–ª–∏—Ç—å –≤–∏–∑—É–∞–ª –∏ –º–∏–∫—Ä–æ–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, –Ω–æ –±–µ–∑ –ª–∏—à–Ω–µ–π —Ç—è–∂–µ—Å—Ç–∏.

     –§–∞–π–ª –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ ¬´—Ç–æ–ª—Å—Ç—ã–π¬ª (>1000 —Å—Ç—Ä–æ–∫) —Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏,
     —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –±—ã–ª–æ –¥–µ–ª–∞—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ.
  ====================================================================== */

  :root{
    /* –ë–∞–∑–æ–≤–∞—è —Ç—ë–º–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞; —á–∞—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞—Ç–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Telegram themeParams */
    --bg:#070910;            /* —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    --card:#0c1018;          /* —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
    --elev:#0f131c;          /* —Ñ–æ–Ω –ø–æ–¥–Ω—è—Ç—ã—Ö –±–ª–æ–∫–æ–≤ */
    --stroke:#1e2633;        /* —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    --text:#e9edf6;          /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
    --muted:#9aa3b2;         /* –≤—Ç–æ—Ä–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç */
    --accent:#7C5CFF;        /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
    --accent-2:#00D1FF;      /* —Ü–∏–∞–Ω */
    --ok:#73FFBF;            /* —É—Å–ø–µ—Ö */
    --warn:#FFD166;          /* –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ */
    --danger:#ff6b81;        /* –æ—à–∏–±–∫–∞ */
    --shadow:0 12px 40px rgba(0,0,0,.36);
    --radius:18px;           /* –æ–±—â–∏–π —Ä–∞–¥–∏—É—Å */
    --gap:12px;              /* –±–∞–∑–æ–≤—ã–π –æ—Ç—Å—Ç—É–ø */
    --safe-top: env(safe-area-inset-top);
    --safe-right: env(safe-area-inset-right);
    --safe-bottom: env(safe-area-inset-bottom);
    --safe-left: env(safe-area-inset-left);

    /* –ê–∫—Ü–µ–Ω—Ç—ã/—Å–≤–µ—á–µ–Ω–∏–µ */
    --glow: 0 0 22px rgba(124,92,255,.38), 0 0 44px rgba(124,92,255,.18);
    --glow-2: 0 0 18px rgba(0,209,255,.35);
  }

  /* ===== –°–±—Ä–æ—Å –∏ –º–æ–±–∏–ª—å–Ω—ã–µ —Ç–≤–∏–∫–∏ ===== */
  *{ box-sizing:border-box }
  html, body{ height:100% }
  html{ scroll-behavior:smooth; -webkit-text-size-adjust: 100% }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    -webkit-tap-highlight-color: transparent; /* —É–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π –±–ª—é—Ä –ø—Ä–∏ —Ç–∞–ø–µ */
    touch-action: manipulation;               /* —É–±–∏—Ä–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É 300ms –∏ dbl‚Äëtap zoom */
  }

  /* ===== –ö–∞—Ä–∫–∞—Å ===== */
  .app{ min-height:100%; display:grid; grid-template-rows:auto 1fr auto }

  .header{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(180deg,rgba(0,0,0,.85),rgba(0,0,0,.5));
    border-bottom:1px solid var(--stroke);
    padding:calc(10px + var(--safe-top)) var(--gap) 10px;
    backdrop-filter: blur(8px);
  }
  .header-wrap{ max-width:980px; margin:0 auto; display:flex; align-items:center; gap:10px }
  .logo{ width:34px; height:34px; border-radius:10px; background:conic-gradient(from 0deg,var(--accent),var(--accent-2),var(--accent)); box-shadow: inset 0 0 0 2px rgba(255,255,255,.06)}
  .title{ display:flex; flex-direction:column }
  .title h1{ margin:0; font-size:16px }
  .title .sub{ margin:2px 0 0; color:var(--muted); font-size:12px }

  /* ===== –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ===== */
  .page{ display:none }
  .page.active{ display:block }
  .container{ max-width:980px; margin:0 auto; padding:14px var(--gap) calc(96px + var(--safe-bottom)) }
  .card{ background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02)); border:1px solid var(--stroke); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow) }
  .grid{ display:grid; gap:12px }
  .block{ border:1px solid var(--stroke); border-radius:16px; background:var(--elev); padding:12px }
  .list{ display:grid; gap:10px }
  .row{ display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:start }
  .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent-2); margin-top:8px; box-shadow:0 0 10px var(--accent-2) }
  .kv{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px }
  .kv .item{ border:1px solid var(--stroke); border-radius:12px; background:#12141a; padding:10px }

  .badges{ display:flex; gap:8px; flex-wrap:wrap }
  .badge{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--stroke); background:#0f1015aa }
  .badge.warn{ border-color:rgba(255,209,102,.4); background:rgba(255,209,102,.08) }

  /* ===== –ú–∞–≥–∞–∑–∏–Ω ===== */
  .shop-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:10px }
  @media (min-width:520px){ .shop-grid{ grid-template-columns:repeat(3,1fr) } }
  .pack{ position:relative; border:1px solid var(--stroke); border-radius:16px; background:linear-gradient(180deg,#0f1220,#0b0f18); padding:12px; display:flex; flex-direction:column; gap:10px; transition: transform .08s ease }
  .pack:active{ transform: scale(.98) }
  .pack h4{ margin:0; font-size:15px }
  .pack .stars{ font-weight:900; font-size:24px; text-shadow: var(--glow-2) }
  .pack .price{ color:var(--muted); font-size:12px }
  .pack .buy{ margin-top:auto; border:1px solid var(--stroke); background:#181c27; color:var(--text); border-radius:12px; padding:12px; font-weight:800; cursor:pointer; text-align:center; min-height:44px }
  .pack .buy.primary{ outline:2px solid rgba(124,92,255,.45); box-shadow: var(--glow) }
  .hint{ font-size:12px; color:var(--accent-2) }

  /* ===== –ü—Ä–æ—Ñ–∏–ª—å / –û–±—ä–µ–∫—Ç ===== */
  .profile{ display:grid; gap:10px }
  .line{ display:flex; justify-content:space-between; border:1px solid var(--stroke); background:#0f1015; padding:12px; border-radius:12px; min-height:44px; align-items:center }
  .line .muted{ color:var(--muted) }
  .obj-grid{ display:grid; gap:10px }
  .obj{ border:1px solid var(--stroke); background:#10151f; border-radius:12px; padding:12px }
  .obj h4{ margin:0 0 8px; font-size:14px; opacity:.9 }
  .obj .kv{ grid-template-columns:repeat(auto-fit,minmax(140px,1fr)) }

  /* ===== –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ ===== */
  .history{ display:grid; gap:10px }
  .hist-row{ display:grid; grid-template-columns:1fr auto; gap:10px; border:1px solid var(--stroke); background:#0f1118; border-radius:12px; padding:12px; align-items:center }
  .hist-row .meta{ font-size:12px; color:var(--muted) }
  .hist-empty{ text-align:center; color:var(--muted); padding:18px }
  .hist-actions{ display:flex; gap:8px; flex-wrap:wrap }
  .btn{ border:1px solid var(--stroke); background:#1b1c22; color:var(--text); border-radius:12px; padding:12px 14px; font-weight:800; cursor:pointer; min-height:44px }
  .btn.primary{ border-color:rgba(124,92,255,.45); box-shadow: var(--glow) }
  .btn.warn{ border-color:rgba(255,209,102,.35) }
  .btn.danger{ border-color:rgba(255,107,129,.35) }

  /* ===== –ü–µ—Å–æ—á–Ω–∏—Ü–∞ (canvas) ===== */
  .canvas-wrap{ position:relative; border:1px solid #0d1420; border-radius:16px; overflow:hidden; background:#000 }
  canvas{ display:block; width:100%; height:360px }
  .scene-hint{ position:absolute; right:10px; top:10px; font-size:12px; color:#6cf; background:rgba(8,20,40,.6); padding:6px 10px; border-radius:999px; border:1px solid #153055 }

  /* ===== FAQ ===== */
  .qa{ display:grid; gap:10px }
  .qa .q{ border:1px solid var(--stroke); background:#11151e; border-radius:12px; padding:2px 10px }
  .qa .q summary{ cursor:pointer; font-weight:800; min-height:44px; display:flex; align-items:center; /* —Ñ–∏–∫—Å –±–∞–≥ –∑—É–º–∞ */ touch-action: manipulation }
  .qa .q summary::-webkit-details-marker{ display:none }
  .qa .q pre{ white-space:pre-wrap; color:var(--muted); margin:8px 0 12px; font-size:14px }

  /* ===== Bottom nav (—Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è, –µ—Å–ª–∏ –≤–∫–ª–∞–¥–æ–∫ –º–Ω–æ–≥–æ) ===== */
  .tabs{ position:sticky; bottom:0; left:0; right:0; z-index:20; background:rgba(0,0,0,.92); backdrop-filter:blur(8px); border-top:1px solid var(--stroke);
         padding:8px calc(var(--gap) + var(--safe-left)) calc(8px + var(--safe-bottom)) calc(var(--gap) + var(--safe-right)) }
  .tabbar{ max-width:980px; margin:0 auto; display:flex; gap:8px; overflow-x:auto; -webkit-overflow-scrolling:touch; scroll-snap-type:x mandatory }
  .tabbtn{ flex:0 0 auto; scroll-snap-align:center; border:1px solid var(--stroke); background:#12151b; color:var(--text); border-radius:12px; padding:8px 10px; text-align:center; cursor:pointer; font-weight:800; font-size:12px; display:flex; flex-direction:column; align-items:center; gap:6px; min-width:70px }
  .tabbtn svg{ width:20px; height:20px; opacity:.92 }
  .tabbtn.active{ outline:2px solid rgba(124,92,255,.45); box-shadow: var(--glow) }

  /* ===== –¢–æ—Å—Ç—ã ===== */
  .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:calc(76px + var(--safe-bottom)); z-index:50; display:none }
  .toast .bubble{ background:rgba(20,24,33,.95); border:1px solid var(--stroke); color:var(--text); padding:10px 12px; border-radius:12px; box-shadow:var(--shadow); font-weight:800 }
  .toast.show{ display:block; animation:toast .2s ease-out }
  @keyframes toast{ from{ opacity:0; transform:translate(-50%,10px) } to{ opacity:1; transform:translate(-50%,0) } }

  /* ===== –°–∫–µ–ª–µ—Ç–æ–Ω—ã ===== */
  .skel{ position:relative; overflow:hidden; background:#12151a }
  .skel::after{ content:""; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent); animation:shine 1.2s infinite }
  @keyframes shine{ from{ transform:translateX(-100%) } to{ transform:translateX(100%) } }

  /* ===== –ú–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è ===== */
  .btn:active{ transform: translateY(1px) }
  .chip:active{ transform: translateY(1px) }
  .appear{ animation: appear .18s ease-out }
  @keyframes appear{ from{ opacity:0; transform: translateY(6px) } to{ opacity:1; transform:none } }

  /* –£–≤–∞–∂–µ–Ω–∏–µ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ ¬´—É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è¬ª */
  @media (prefers-reduced-motion:reduce){
    .toast{ animation: none }
    .appear{ animation:none }
  }
  </style>
</head>
<body>
<div class="app" id="app">
  <!-- ======================== HEADER ======================== -->
  <header class="header">
    <div class="header-wrap">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <h1>Qleweta ‚Äî –ú–∏–Ω–∏‚Äë–∞–ø–ø</h1>
        <p class="sub">–í–µ—Ä—Å–∏—è 2.0 ¬∑ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</p>
      </div>
    </div>
  </header>

  <!-- ======================== CONTENT PAGES ======================== -->
  <main id="pages">
    <!-- ===== PAGE: STATUS ===== -->
    <section class="page active" id="page-status" aria-labelledby="tab-status">
      <div class="container">
        <div class="card appear">
          <div class="badges" style="justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <span class="badge warn">Production</span>
              <span class="badge" id="badgeVer">–í–µ—Ä—Å–∏—è: 2.0</span>
              <span class="badge" id="badgeUpd">–û–±–Ω–æ–≤–ª–µ–Ω–æ: —Å–µ–≥–æ–¥–Ω—è</span>
            </div>
            <div class="badge" id="badgeClient">Client: ‚Äî</div>
          </div>

          <div class="grid">
            <div class="block">
              <h3>–ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
              <div class="list" id="worksList">
                <div class="row"><div class="dot"></div><div>–ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è: bottom‚Äënav, safe‚Äëarea, –∫—Ä—É–ø–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤—ã.</div></div>
                <div class="row"><div class="dot"></div><div>–ì–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp API: MainButton/BackButton, Haptics, Theme.</div></div>
                <div class="row"><div class="dot"></div><div>–ú–∞–≥–∞–∑–∏–Ω Stars: <code>sendData("buy_XX")</code> ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –≤ —á–∞—Ç.</div></div>
                <div class="row"><div class="dot"></div><div>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫: –ª–æ–∫–∞–ª—å–Ω–æ–µ/–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç, –æ—á–∏—Å—Ç–∫–∞.</div></div>
                <div class="row"><div class="dot"></div><div>–ü–ª–∏—Ç–∫–∞ ¬´–û–±—ä–µ–∫—Ç¬ª: –ø–æ–ª–Ω–∞—è —Å–≤–æ–¥–∫–∞ (—é–∑–µ—Ä, –ø—Ä–µ–º–∏—É–º, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —Ç–µ–º–∞, –≤–µ—Ä—Å–∏—è –∏ —Ç.–ø.).</div></div>
                <div class="row"><div class="dot"></div><div>–¢–æ—Å—Ç—ã, —Å–∫–µ–ª–µ—Ç–æ–Ω—ã, –æ—Ñ—Ñ–ª–∞–π–Ω‚Äë–¥–µ—Ç–µ–∫—Ç, –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å, –∞–Ω—Ç–∏‚Äëdbltap –∑—É–º –≤ FAQ.</div></div>
              </div>
            </div>

            <div class="block">
              <h3>–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞</h3>
              <div class="kv">
                <div class="item"><b>–ò—Å—Ç–æ—Ä–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞</b><br><span class="muted">–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º/–±–æ—Ç–æ–º</span></div>
                <div class="item"><b>–ü—Ä–æ–º–æ–∫–æ–¥—ã</b><br><span class="muted">–≤–≤–æ–¥ –ø—Ä—è–º–æ –≤ –∞–ø–ø–µ</span></div>
                <div class="item"><b>–†–µ—Ñ–µ—Ä–∞–ª—ã</b><br><span class="muted">–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫</span></div>
                <div class="item"><b>–¢–µ–º—ã Glow/Neon</b><br><span class="muted">—Ä—É—á–Ω–æ–π –≤—ã–±–æ—Ä</span></div>
              </div>
            </div>

            <div class="block">
              <h3>–ß–µ–π–Ω–¥–∂–ª–æ–≥ 2.0</h3>
              <div class="list">
                <div class="row"><div class="dot"></div><div>–£–¥–∞–ª—ë–Ω –ø–µ—Ä–µ–≤–æ–¥: –æ–¥–∏–Ω —è–∑—ã–∫ (RU), –º–µ–Ω—å—à–µ –∫–æ–¥–∞ ‚Äî –±–æ–ª—å—à–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.</div></div>
                <div class="row"><div class="dot"></div><div>–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è ¬´–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫¬ª: CloudStorage/LocalStorage, —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç JSON.</div></div>
                <div class="row"><div class="dot"></div><div>–ü–ª–∏—Ç–∫–∞ ¬´–û–±—ä–µ–∫—Ç¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è initDataUnsafe, —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É, –ø–ª–∞—Ç—Ñ–æ—Ä–º—É.</div></div>
                <div class="row"><div class="dot"></div><div>FAQ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω: –∂–µ—Å—Ç—ã –±–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è; summary —Å <code>touch-action: manipulation</code>.</div></div>
                <div class="row"><div class="dot"></div><div>–í–∏–∑—É–∞–ª —É—Å–∏–ª–µ–Ω: glow, —Ç–µ–Ω–∏, –ø–ª–∞–≤–Ω—ã–µ –ø–æ—è–≤–ª–µ–Ω–∏—è, —Ç–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ—Ç–¥–∞—á–∞.</div></div>
              </div>
            </div>

            <div class="block">
              <h3>–î–∏—Å–∫–ª–µ–π–º–µ—Ä</h3>
              <div class="list">
                <div class="row"><div class="dot"></div><div>–û–ø–ª–∞—Ç—ã Stars –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Telegram. –î–µ–π—Å—Ç–≤—É–π—Ç–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.</div></div>
                <div class="row"><div class="dot"></div><div>–ú—ã –Ω–µ –æ—Ç–≤–µ—á–∞–µ–º –∑–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã. –ü–æ–ª—å–∑—É—è—Å—å –∞–ø–ø–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏.</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PAGE: SHOP ===== -->
    <section class="page" id="page-shop" aria-labelledby="tab-shop">
      <div class="container">
        <div class="card appear">
          <div class="grid">
            <div class="block">
              <h3>–ú–∞–≥–∞–∑–∏–Ω Stars</h3>
              <p class="muted">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç ‚Äî –∏–Ω–≤–æ–π—Å –ø—Ä–∏–¥—ë—Ç –≤ —á–∞—Ç. –û–ø–ª–∞—Ç–∞ –≤ XTR.</p>
              <div class="shop-grid" id="shopGrid">
                <div class="pack" data-amt="5">
                  <h4>–ü–∞–∫–µ—Ç</h4>
                  <div class="stars">5‚≠ê</div>
                  <div class="price">–º–∏–∫—Ä–æ‚Äë–ø–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                  <button class="buy">–ö—É–ø–∏—Ç—å 5‚≠ê</button>
                </div>
                <div class="pack" data-amt="20">
                  <h4>–ü–∞–∫–µ—Ç</h4>
                  <div class="stars">20‚≠ê</div>
                  <div class="price">–ª—É—á—à–∏–π –≤—ã–±–æ—Ä</div>
                  <button class="buy primary">–ö—É–ø–∏—Ç—å 20‚≠ê</button>
                </div>
                <div class="pack" data-amt="100">
                  <h4>–ü–∞–∫–µ—Ç</h4>
                  <div class="stars">100‚≠ê</div>
                  <div class="price">—Å–µ—Ä–¥–µ—á–Ω–æ ‚ù§Ô∏è</div>
                  <button class="buy">–ö—É–ø–∏—Ç—å 100‚≠ê</button>
                </div>
              </div>
              <p class="hint">–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —á–∞—Ç. –ï—Å–ª–∏ —Å—á—ë—Ç –Ω–µ –ø—Ä–∏—à—ë–ª ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PAGE: PROFILE (–æ–±—ä–µ–∫—Ç) ===== -->
    <section class="page" id="page-profile" aria-labelledby="tab-profile">
      <div class="container">
        <div class="card appear">
          <div class="grid profile" id="profileGrid">
            <div class="line"><span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span><span id="p_name" class="muted">‚Äî</span></div>
            <div class="line"><span>–Æ–∑–µ—Ä–Ω–µ–π–º</span><span id="p_username" class="muted">‚Äî</span></div>
            <div class="line"><span>ID</span><span id="p_id" class="muted">‚Äî</span></div>
          </div>
          <div class="obj" style="margin-top:12px">
            <h4>–û–±—ä–µ–∫—Ç</h4>
            <div class="kv">
              <div class="item"><b>–ü—Ä–µ–º–∏—É–º</b><br><span class="muted" id="o_premium">‚Äî</span></div>
              <div class="item"><b>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</b><br><span class="muted" id="o_platform">‚Äî</span></div>
              <div class="item"><b>–¢–µ–º–∞</b><br><span class="muted" id="o_scheme">‚Äî</span></div>
              <div class="item"><b>–í–µ—Ä—Å–∏—è WebApp</b><br><span class="muted" id="o_version">‚Äî</span></div>
              <div class="item"><b>isExpanded</b><br><span class="muted" id="o_expanded">‚Äî</span></div>
              <div class="item"><b>start_param</b><br><span class="muted" id="o_start">‚Äî</span></div>
              <div class="item"><b>chat_type</b><br><span class="muted" id="o_chat">‚Äî</span></div>
              <div class="item"><b>viewport</b><br><span class="muted" id="o_view">‚Äî</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PAGE: HISTORY ===== -->
    <section class="page" id="page-history" aria-labelledby="tab-history">
      <div class="container">
        <div class="card appear">
          <div class="grid">
            <div class="block">
              <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h3>
              <p class="muted" id="histSub">–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–∫—É–ø–∫–∏, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –º–∏–Ω–∏‚Äë–∞–ø–ø –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ ‚Äî —Ö—Ä–∞–Ω–∏–º –≤ Telegram CloudStorage, –∏–Ω–∞—á–µ ‚Äî –≤ LocalStorage.</p>
              <div class="history" id="histList"><div class="hist-empty">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–∫—É–ø–∫—É –≤ ¬´–ú–∞–≥–∞–∑–∏–Ω–µ¬ª.</div></div>
              <div class="hist-actions" style="margin-top:10px">
                <button class="btn" id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                <button class="btn" id="btnImport">–ò–º–ø–æ—Ä—Ç JSON</button>
                <button class="btn warn" id="btnSync">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn danger" id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>
              <p class="hint">–î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å–≤—è–∂–∏—Ç–µ –±–æ—Ç–∞: –ø–æ –Ω–∞–∂–∞—Ç–∏—é ¬´–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å¬ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º <code>sendData("history:sync")</code>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PAGE: SANDBOX ===== -->
    <section class="page" id="page-sandbox" aria-labelledby="tab-sandbox">
      <div class="container">
        <div class="card appear">
          <div class="grid">
            <div class="block">
              <h3>–ü–µ—Å–æ—á–Ω–∏—Ü–∞</h3>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 10px">
                <button class="chip btn" data-scene="gpt">ü§ñ ChatGPT Scene</button>
                <button class="chip btn" data-scene="eyes">üëÄ Eyes</button>
                <button class="chip btn" data-scene="parts">‚ú® Particles</button>
              </div>

              <!-- GPT Scene -->
              <div class="canvas-wrap scene" id="scene-gpt">
                <canvas id="chat"></canvas>
                <div class="scene-hint">—Ç–∞–ø–Ω–∏/–∫–ª–∏–∫–Ω–∏ –ø–æ —ç–∫—Ä–∞–Ω—É</div>
                <div class="chatlayer" id="chatLayer" style="position:absolute;inset:0;display:grid;place-items:center;text-align:center;color:#00ffd0;text-shadow:0 0 8px #00ffaa;white-space:pre-line;font-family:ui-monospace,monospace">
                  <div>
                    <div id="l1" style="font-size:18px"></div>
                    <div id="l2" style="font-size:18px"></div>
                  </div>
                </div>
                <div class="crt" style="position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;background:repeating-linear-gradient(0deg,rgba(255,255,255,.04),rgba(255,255,255,.04) 1px,transparent 2px,transparent 3px);opacity:.06"></div>
              </div>

              <!-- Eyes Scene -->
              <div class="canvas-wrap scene" id="scene-eyes" style="display:none">
                <canvas id="eyes"></canvas>
                <div class="scene-hint">—Ç–∞–ø–Ω–∏ –ø–æ –≥–ª–∞–∑—É ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç</div>
              </div>

              <!-- Parts Scene -->
              <div class="canvas-wrap scene" id="scene-parts" style="display:none">
                <canvas id="parts"></canvas>
                <div class="scene-hint">—Ç–∞–ø ‚Äî —Å–ø–∞–≤–Ω —á–∞—Å—Ç–∏—Ü ‚Ä¢ –∫—É—Ä—Å–æ—Ä –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PAGE: FAQ ===== -->
    <section class="page" id="page-faq" aria-labelledby="tab-faq">
      <div class="container">
        <div class="card appear">
          <div class="grid">
            <div class="block">
              <h3>FAQ</h3>
              <div class="qa" id="faqList">
                <details class="q"><summary>–ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç–∞?</summary><pre>–ù–∞–∂–º–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–∑–∞–¥ –≤ Telegram –∏–ª–∏ –∫–Ω–æ–ø–∫—É ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª (MainButton).
–ï—Å–ª–∏ MainButton –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –æ–Ω —Ç–æ–∂–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebApp.</pre></details>
                <details class="q"><summary>–ü–æ—á–µ–º—É –∫–Ω–æ–ø–∫–∞ –Ω–µ –ø—Ä–∏—Å–ª–∞–ª–∞ —Å—á—ë—Ç?</summary><pre>–ò–Ω–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º.</pre></details>
                <details class="q"><summary>–ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é?</summary><pre>–í–∫–ª–∞–¥–∫–∞ ¬´–ò—Å—Ç–æ—Ä–∏—è¬ª –≤–µ–¥—ë—Ç –ª–æ–∫–∞–ª—å–Ω—É—é (–∏–ª–∏ –æ–±–ª–∞—á–Ω—É—é) –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–æ–∫ –∏–∑ –º–∏–Ω–∏‚Äë–∞–ø–ø–∞. –î–ª—è –ø–æ–ª–Ω–æ–π —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞.</pre></details>
                <details class="q"><summary>–ì–¥–µ –º–æ–π –±–∞–ª–∞–Ω—Å?</summary><pre>–ë–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥ ‚Äî –≤ –ø—Ä–æ—Ñ–∏–ª–µ –±–æ—Ç–∞ ‚Üí Balance (Stars), –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π /balance (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).</pre></details>
              </div>
            </div>
            <div class="block">
              <h3>–û—Ç–ª–∞–¥–∫–∞</h3>
              <div class="list">
                <div class="row"><div class="dot"></div><div>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞: <code id="dbgClient">‚Äî</code></div></div>
                <div class="row"><div class="dot"></div><div>ThemeParams: <code id="dbgTheme">‚Äî</code></div></div>
                <div class="row"><div class="dot"></div><div>isExpanded: <code id="dbgExp">‚Äî</code></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ======================== BOTTOM NAV (6 –≤–∫–ª–∞–¥–æ–∫) ======================== -->
  <nav class="tabs" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="tabbar">
      <button class="tabbtn active" id="tab-status" data-page="page-status" aria-controls="page-status" aria-selected="true" title="–°—Ç–∞—Ç—É—Å">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12h16" stroke="currentColor" stroke-width="2"/><path d="M4 6h10" stroke="currentColor" stroke-width="2"/><path d="M4 18h12" stroke="currentColor" stroke-width="2"/></svg>
        <span>–°—Ç–∞—Ç—É—Å</span>
      </button>
      <button class="tabbtn" id="tab-shop" data-page="page-shop" aria-controls="page-shop" title="–ú–∞–≥–∞–∑–∏–Ω">
        <svg viewBox="0 0 24 24" fill="none"><path d="M3 7h18l-1 12H4L3 7Z" stroke="currentColor" stroke-width="2"/><path d="M7 7V5a5 5 0 0 1 10 0v2" stroke="currentColor" stroke-width="2"/></svg>
        <span>–ú–∞–≥–∞–∑–∏–Ω</span>
      </button>
      <button class="tabbtn" id="tab-profile" data-page="page-profile" aria-controls="page-profile" title="–ü—Ä–æ—Ñ–∏–ª—å">
        <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/><path d="M4 20c2-4 6-6 8-6s6 2 8 6" stroke="currentColor" stroke-width="2"/></svg>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
      <button class="tabbtn" id="tab-history" data-page="page-history" aria-controls="page-history" title="–ò—Å—Ç–æ—Ä–∏—è">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2"/><path d="M3 12a9 9 0 1 0 9-9" stroke="currentColor" stroke-width="2"/><path d="M3 5v7h7" stroke="currentColor" stroke-width="2"/></svg>
        <span>–ò—Å—Ç–æ—Ä–∏—è</span>
      </button>
      <button class="tabbtn" id="tab-sandbox" data-page="page-sandbox" aria-controls="page-sandbox" title="–ü–µ—Å–æ—á–Ω–∏—Ü–∞">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="2"/></svg>
        <span>–ü–µ—Å–æ—á–Ω–∏—Ü–∞</span>
      </button>
      <button class="tabbtn" id="tab-faq" data-page="page-faq" aria-controls="page-faq" title="FAQ">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 18h.01" stroke="currentColor" stroke-width="2"/><path d="M9 8a3 3 0 1 1 6 0c0 2-3 2-3 4" stroke="currentColor" stroke-width="2"/></svg>
        <span>FAQ</span>
      </button>
    </div>
  </nav>
</div>

<!-- ======================== TOAST ======================== -->
<div class="toast" id="toast" role="status" aria-live="polite"><div class="bubble" id="toastText">‚Äî</div></div>

<script>
/* ====================================================================
   QLEWETA MINI‚ÄëAPP ‚Äî MOBILE PRO v2 JS (Production)
   --------------------------------------------------------------------
   –ë–µ–∑ –ø–µ—Ä–µ–≤–æ–¥–æ–≤, —Ç–æ–ª—å–∫–æ RU. –ó–¥–µ—Å—å: —Ä–æ—É—Ç–µ—Ä, –∏—Å—Ç–æ—Ä–∏—è, —Å—Ü–µ–Ω—ã, —Ç–µ–º–∞, FAQ‚Äë—Ñ–∏–∫—Å,
   –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp API. –ö–æ–¥ —Å–Ω–∞–±–∂–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
   ==================================================================== */
(function(){
  'use strict';

  // ----------------------- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -----------------------
  const S = {
    version: '2.0',
    tg: (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null,
    scenes: { gpt: null, eyes: null, parts: null },
    currentPage: 'page-status',
    haptics: true,
    offline: !navigator.onLine,
    histKey: 'qleweta:history',         // –∫–ª—é—á –¥–ª—è LocalStorage
    histCloudPrefix: 'qleweta:hist:',   // –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è CloudStorage (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    userId: null,
    dblTapBlockMs: 320,                 // –∞–Ω—Ç–∏ dbl‚Äëtap zoom –¥–ª—è FAQ
    lastTouchTime: 0,
  };

  // ----------------------- –£—Ç–∏–ª–∏—Ç—ã -----------------------
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const on = (el, ev, fn, opt) => el && el.addEventListener(ev, fn, opt);

  function toast(msg){
    const box=$('#toast'); const txt=$('#toastText');
    if(!box||!txt) return; txt.textContent=msg; box.classList.add('show');
    if(S.haptics) try{ S.tg?.HapticFeedback?.notificationOccurred('success'); }catch(e){}
    clearTimeout(toast._t); toast._t=setTimeout(()=> box.classList.remove('show'), 1800);
  }

  function setActivePage(id){
    if(S.currentPage===id) return;
    $$('.page').forEach(p=>p.classList.toggle('active', p.id===id));
    $$('.tabbtn').forEach(b=>b.classList.toggle('active', b.dataset.page===id));
    S.currentPage = id;
    updateMainButton();
    stopScenesExcept(id);
    try{ window.scrollTo({top:0,behavior:'smooth'}); }catch(e){}
  }

  function stopScenesExcept(id){
    const stop = name => { if(S.scenes[name] && typeof S.scenes[name].stop==='function') S.scenes[name].stop(); };
    if(id!=='page-sandbox'){ stop('gpt'); stop('eyes'); stop('parts'); }
  }

  function haptic(type='light'){ if(!S.haptics) return; try{ S.tg?.HapticFeedback?.impactOccurred(type); }catch(e){} }
  function closeApp(){ try{ S.tg?.close(); }catch(e){} }

  // ----------------------- –¢–µ–º–∞ –∏–∑ Telegram -----------------------
  function applyThemeFromTelegram(){
    if(!S.tg) return;
    const th = S.tg.themeParams||{};
    const map={ text_color:'--text', hint_color:'--muted', bg_color:'--bg', secondary_bg_color:'--card', link_color:'--accent-2', button_color:'--accent', button_text_color:'--text' };
    for(const k in map){ if(th[k]) document.documentElement.style.setProperty(map[k], th[k]); }
  }

  // ----------------------- Offline detector -----------------------
  function updateOffline(){
    if(!navigator.onLine){ S.offline=true; toast('‚ö†Ô∏è –ù–µ—Ç —Å–µ—Ç–∏'); }
    else if(S.offline){ S.offline=false; toast('‚úÖ –°–µ—Ç—å –µ—Å—Ç—å'); }
  }

  // ----------------------- –ü—Ä–æ—Ñ–∏–ª—å / –û–±—ä–µ–∫—Ç -----------------------
  function fillProfile(){
    const unsafe = S.tg?.initDataUnsafe||{}; const user=unsafe.user||{};
    S.userId = user.id||null;
    $('#p_name').textContent = [user.first_name,user.last_name].filter(Boolean).join(' ')||'‚Äî';
    $('#p_username').textContent = user.username?('@'+user.username):'‚Äî';
    $('#p_id').textContent = user.id||'‚Äî';

    const client = `${S.tg?.platform||'web'}`; $('#badgeClient').textContent = 'Client: '+client; $('#dbgClient').textContent = client; $('#o_platform').textContent = client;
    $('#o_premium').textContent = user.is_premium ? '–¥–∞' : '–Ω–µ—Ç';
    $('#o_scheme').textContent = S.tg?.colorScheme||'‚Äî';
    $('#o_version').textContent = S.tg?.version||'‚Äî';
    $('#o_expanded').textContent = S.tg?.isExpanded?'true':'false';
    $('#o_start').textContent = unsafe.start_param||'‚Äî';
    $('#o_chat').textContent = unsafe.chat_type||'‚Äî';
    $('#dbgTheme').textContent = JSON.stringify(S.tg?.themeParams||{},null,0);
    $('#dbgExp').textContent = S.tg?.isExpanded?'true':'false';

    const vw = Math.round(window.innerWidth) + '√ó' + Math.round(window.innerHeight);
    $('#o_view').textContent = vw;
  }

  // ----------------------- –ú–∞–≥–∞–∑–∏–Ω: –ø–æ–∫—É–ø–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è -----------------------
  let buyLock = false;
  function buyStars(amount){
    if(buyLock) return; buyLock = true; setTimeout(()=> buyLock=false, 1200);
    haptic('rigid');
    try{
      S.tg?.sendData?.('buy_'+amount);
      toast('–ó–∞–ø—Ä–æ—Å –Ω–∞ '+amount+'‚≠ê –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥–∑–∞–ø–∏—Å—å (—Å—Ç–∞—Ç—É—Å pending), —á—Ç–æ–±—ã —é–∑–µ—Ä –≤–∏–¥–µ–ª –¥–µ–π—Å—Ç–≤–∏–µ.
      pushHistory({ ts: Date.now(), amount, status:'pending', payload:'order_'+amount });
      renderHistory();
      setTimeout(()=> closeApp(), 220);
    }catch(e){ toast('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å'); }
  }

  // ===== –ò—Å—Ç–æ—Ä–∏—è: —Ö—Ä–∞–Ω–µ–Ω–∏–µ =====
  function hasCloud(){ return !!(S.tg && S.tg.CloudStorage && typeof S.tg.CloudStorage.setItem==='function'); }
  function cloudKey(){ return S.userId ? (S.histCloudPrefix + S.userId) : S.histKey; }

  async function loadHistory(){
    try{
      if(hasCloud()){
        const json = await S.tg.CloudStorage.getItem(cloudKey());
        if(json){ return JSON.parse(json); }
      }
    }catch(e){ /* fallback –Ω–∏–∂–µ */ }
    try{
      const json = localStorage.getItem(S.histKey); if(json) return JSON.parse(json);
    }catch(e){ /* ignore */ }
    return [];
  }

  async function saveHistory(list){
    const json = JSON.stringify(list.slice(-200)); // –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ä–∞–∑–º–µ—Ä
    try{ if(hasCloud()) await S.tg.CloudStorage.setItem(cloudKey(), json); }catch(e){ /* fallback */ }
    try{ localStorage.setItem(S.histKey, json); }catch(e){ /* ignore */ }
  }

  async function pushHistory(item){ const list = await loadHistory(); list.push(item); await saveHistory(list); }
  async function clearHistory(){ await saveHistory([]); }

  // ===== –ò—Å—Ç–æ—Ä–∏—è: —Ä–µ–Ω–¥–µ—Ä =====
  async function renderHistory(){
    const box = $('#histList'); if(!box) return;
    const list = await loadHistory();
    if(!list || list.length===0){ box.innerHTML = '<div class="hist-empty">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–∫—É–ø–∫—É –≤ ¬´–ú–∞–≥–∞–∑–∏–Ω–µ¬ª.</div>'; return; }
    box.innerHTML = '';
    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—Ä—Ö—É
    list.slice().reverse().forEach(ev=>{
      const dt = new Date(ev.ts||Date.now());
      const dstr = dt.toLocaleString();
      const row = document.createElement('div'); row.className = 'hist-row';
      const left = document.createElement('div');
      const right = document.createElement('div');
      left.innerHTML = '<b>'+ (ev.amount||'?') +'‚≠ê</b><div class="meta">'+(ev.payload||'‚Äî')+'</div>';
      right.innerHTML = '<div style="text-align:right"><div>'+ (ev.status||'‚Äî') +'</div><div class="meta">'+ dstr +'</div></div>';
      row.appendChild(left); row.appendChild(right);
      box.appendChild(row);
    });
  }

  // ===== –ò—Å—Ç–æ—Ä–∏—è: —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç/—Å–∏–Ω–∫ =====
  function exportHistory(){
    loadHistory().then(list=>{
      const blob = new Blob([JSON.stringify(list,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='qleweta-history.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url), 1000);
      toast('–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω JSON');
    });
  }

  function importHistory(){
    const input = document.createElement('input'); input.type = 'file'; input.accept = 'application/json';
    input.onchange = async () => {
      const f = input.files && input.files[0]; if(!f) return;
      const text = await f.text();
      try{ const list = JSON.parse(text); if(Array.isArray(list)){ await saveHistory(list); toast('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω JSON'); renderHistory(); } else { toast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç'); } }
      catch(e){ toast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞'); }
    };
    input.click();
  }

  function syncHistory(){
    // –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª: –ø—Ä–æ—Å–∏–º –±–æ—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å ‚Äî –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏—Å–ª–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ —á–∞—Ç –∏–ª–∏
    // –≤ –±—É–¥—É—â–µ–º –æ–±–Ω–æ–≤–∏—Ç—å CloudStorage –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏ (–∫–æ–≥–¥–∞ —É –≤–∞—Å –±—É–¥–µ—Ç –±—ç–∫–µ–Ω–¥/–±–æ—Ç‚Äë–æ–±—Ä–∞–±–æ—Ç—á–∏–∫).
    try{ S.tg?.sendData?.('history:sync'); toast('–ó–∞–ø—Ä–æ—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω'); }
    catch(e){ toast('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å'); }
  }

  // ----------------------- –°—Ü–µ–Ω—ã (canvas) -----------------------
  function SceneGPT(){
    let canvas,ctx,raf=0,started=false,clickBound=false,t=0;
    return {
      start(){ if(started) return; started=true; canvas=$('#chat'); ctx=canvas.getContext('2d');
        const resize=()=>{ const box=canvas.parentElement,W=box.clientWidth,H=360; const dpr=window.devicePixelRatio||1; canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px'; ctx.setTransform(dpr,0,0,dpr,0,0);};
        this._resize=resize; resize(); window.addEventListener('resize',resize);
        const loop=()=>{ t+=0.015; const W=canvas.width/(window.devicePixelRatio||1), H=canvas.height/(window.devicePixelRatio||1);
          const r=60+Math.sin(t)*25,R=360; const gx=W/2+Math.sin(t*0.7)*40, gy=H/2+Math.cos(t*0.6)*24; const g=ctx.createRadialGradient(gx,gy,r,W/2,H/2,R);
          g.addColorStop(0,'rgba(0,255,210,0.32)'); g.addColorStop(0.45,'rgba(0,140,200,0.15)'); g.addColorStop(1,'rgba(0,0,0,1)'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
          raf=requestAnimationFrame(loop);
        }; loop();
        const l1=$('#l1'), l2=$('#l2');
        const type=(el,txt,spd=22,done)=>{ el.textContent=''; let i=0; const tick=()=>{ if(i<txt.length){ el.textContent+=txt[i++]; if(i%3===0) haptic('light'); setTimeout(tick,spd);} else done&&done(); }; tick(); };
        type(l1,'üëã –ü—Ä–∏–≤–µ—Ç! –Ø ChatGPT. –ù–∞–∂–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî –æ—Ç–≤–µ—á—É',18);
        if(!clickBound){ clickBound=true; const trigger=()=>{ l1.textContent='–û—Ç–≤–µ—Ç:'; type(l2,'–ê—Ö–∞—Ö–∞—Ö üòÜ –Ω—É —Ç—ã —á—ë, –ø–æ–≤–µ—Ä–∏–ª?\nAPI –¥–æ—Ä–æ–≥–∏–µ —Å–µ–π—á–∞—Å, –±—Ä–æ üí∏',14); }; on($('#scene-gpt'),'click',trigger,{passive:true}); on($('#scene-gpt'),'touchstart',e=>{e.preventDefault();trigger();},{passive:false}); }
      },
      stop(){ if(!started) return; started=false; cancelAnimationFrame(raf); window.removeEventListener('resize',this._resize); }
    }
  }

  function SceneEyes(){
    let canvas,ctx,raf=0,started=false,eyes=[],mx=0,my=0,active=false,dpr=1,W=0,H=0;
    return {
      start(){ if(started) return; started=true; canvas=$('#eyes'); ctx=canvas.getContext('2d');
        const resize=()=>{ const box=canvas.parentElement; W=box.clientWidth; H=360; dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1)); canvas.width=W*dpr;canvas.height=H*dpr; canvas.style.width=W+'px';canvas.style.height=H+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); eyes=[{x:W*0.38,y:H*0.5,r:62,iris:'#66ccff'},{x:W*0.62,y:H*0.5,r:62,iris:'#66ccff'}]; mx=W/2; my=H/2; };
        this._resize=resize; resize(); window.addEventListener('resize',resize);
        const setMouse=e=>{ const r=canvas.getBoundingClientRect(); const p=('touches'in e)?e.touches[0]:e; mx=p.clientX-r.left; my=p.clientY-r.top; active=true; };
        const clearMouse=()=>{ active=false; };
        on(canvas,'mousemove',setMouse); on(canvas,'mouseleave',clearMouse); on(canvas,'touchstart',setMouse,{passive:false}); on(canvas,'touchmove',setMouse,{passive:false}); on(window,'touchend',clearMouse);
        on(canvas,'click',e=>{ const r=canvas.getBoundingClientRect(); const x=e.clientX-r.left,y=e.clientY-r.top; for(const eye of eyes){ if(Math.hypot(x-eye.x,y-eye.y)<=eye.r) eye.iris=`hsl(${(Math.random()*360)|0},90%,60%)`; } });
        const drawEye=eye=>{ const {x,y,r,iris}=eye; ctx.shadowBlur=18; ctx.shadowColor='rgba(180,200,255,.35)'; ctx.fillStyle='#0b0f18'; ctx.strokeStyle='#2a2f3a'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); ctx.stroke(); const dx=mx-x, dy=my-y, dist=Math.hypot(dx,dy); const lim=r*0.45; const px=x+(dist>lim?dx/dist*lim:dx); const py=y+(dist>lim?dy/dist*lim:dy); ctx.shadowBlur=20; ctx.shadowColor=iris; ctx.fillStyle=iris; ctx.beginPath(); ctx.arc(px,py,r*0.36,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=10; ctx.shadowColor='#000'; ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(px,py,r*0.18,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0; ctx.fillStyle='rgba(255,255,255,.9)'; ctx.beginPath(); ctx.arc(px-r*0.1,py-r*0.1,r*0.06,0,Math.PI*2); ctx.fill(); };
        const loop=()=>{ ctx.clearRect(0,0,W,H); ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); eyes[0].x=W*0.38; eyes[0].y=H*0.5; eyes[1].x=W*0.62; eyes[1].y=H*0.5; for(const e of eyes) drawEye(e); raf=requestAnimationFrame(loop); };
        loop();
      },
      stop(){ if(!started) return; started=false; cancelAnimationFrame(raf); window.removeEventListener('resize',this._resize); }
    }
  }

  function SceneParts(){
    let canvas,ctx,raf=0,started=false,P=[],mx=0,my=0,active=false,dpr=1,W=0,H=0,last=0;
    const spawn=(x,y,n=16)=>{ for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2; const v=40+Math.random()*140; P.push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,r:2+Math.random()*3,h:(Math.random()*360)|0,life:2}); } };
    return {
      start(){ if(started) return; started=true; canvas=$('#parts'); ctx=canvas.getContext('2d');
        const resize=()=>{ const box=canvas.parentElement; W=box.clientWidth; H=360; dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1)); canvas.width=W*dpr;canvas.height=H*dpr; canvas.style.width=W+'px';canvas.style.height=H+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); };
        this._resize=resize; resize(); window.addEventListener('resize',resize);
        const setMouse=e=>{ const r=canvas.getBoundingClientRect(); const p=('touches'in e)?e.touches[0]:e; mx=p.clientX-r.left; my=p.clientY-r.top; active=true; };
        const clearMouse=()=>{ active=false; };
        on(canvas,'mousemove',setMouse); on(canvas,'mouseleave',clearMouse); on(canvas,'touchstart',setMouse,{passive:false}); on(canvas,'touchmove',setMouse,{passive:false}); on(window,'touchend',clearMouse);
        on(canvas,'click',e=>{ const r=canvas.getBoundingClientRect(); spawn(e.clientX-r.left,e.clientY-r.top,20); haptic('medium'); });
        spawn(W/2,H/2,28); last=performance.now();
        const loop=(now)=>{ const dt=Math.min(40,now-last)/1000; last=now; ctx.fillStyle='rgba(0,0,0,0.25)'; ctx.fillRect(0,0,W,H); for(const p of P){ if(active){ const dx=mx-p.x, dy=my-p.y, d=Math.hypot(dx,dy)+1; const f=120/d; p.vx+=dx/d*f*dt; p.vy+=dy/d*f*dt; } p.vx*=0.99; p.vy*=0.99; p.x+=p.vx*dt; p.y+=p.vy*dt; if(p.x<0||p.x>W) p.vx*=-1; if(p.y<0||p.y>H) p.vy*=-1; p.life-=dt*0.25; ctx.shadowBlur=14; ctx.shadowColor=`hsla(${p.h},100%,60%,.9)`; ctx.fillStyle=`hsla(${p.h},95%,60%,.9)`; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); } for(let i=P.length-1;i>=0;i--) if(P[i].life<=0) P.splice(i,1); raf=requestAnimationFrame(loop); };
        raf=requestAnimationFrame(loop);
      },
      stop(){ if(!started) return; started=false; cancelAnimationFrame(raf); window.removeEventListener('resize',this._resize); }
    }
  }

  // ----------------------- –ù–∞–≤–∏–≥–∞—Ü–∏—è -----------------------
  function bindTabs(){ $$('.tabbtn').forEach(btn=> on(btn,'click',()=>{ setActivePage(btn.dataset.page); haptic('light'); })); }

  function bindShop(){ $$('#page-shop .pack .buy').forEach(b=> on(b,'click',()=> buyStars(+b.closest('.pack').dataset.amt))); }

  function bindSandbox(){
    const chips=$$('#page-sandbox .chip');
    const show=id=>{
      $('#scene-gpt').style.display= id==='gpt'?'':'none';
      $('#scene-eyes').style.display= id==='eyes'?'':'none';
      $('#scene-parts').style.display= id==='parts'?'':'none';
      chips.forEach(c=>c.classList.toggle('active', c.dataset.scene===id));
      if(id==='gpt'){ S.scenes.gpt||(S.scenes.gpt=SceneGPT()); S.scenes.gpt.start(); }
      if(id==='eyes'){ S.scenes.eyes||(S.scenes.eyes=SceneEyes()); S.scenes.eyes.start(); }
      if(id==='parts'){ S.scenes.parts||(S.scenes.parts=SceneParts()); S.scenes.parts.start(); }
    };
    chips.forEach(c=> on(c,'click',()=>{ show(c.dataset.scene); haptic('light'); }));
    show('gpt');
  }

  function bindHistory(){
    on($('#btnExport'),'click',()=>{ exportHistory(); haptic('light'); });
    on($('#btnImport'),'click',()=>{ importHistory(); haptic('light'); });
    on($('#btnClear'),'click',async()=>{ await clearHistory(); renderHistory(); toast('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞'); haptic('light'); });
    on($('#btnSync'),'click',()=>{ syncHistory(); haptic('light'); });
    renderHistory();
  }

  // ----------------------- Anti dbl‚Äëtap zoom –¥–ª—è FAQ -----------------------
  function bindFAQZoomFix(){
    // uSafari –∏–Ω–æ–≥–¥–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ –ø–æ summary; –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –±—ã—Å—Ç—Ä—ã–µ –¥–≤–æ–π–Ω—ã–µ –∫–∞—Å–∞–Ω–∏—è
    on($('#faqList'),'touchend',(e)=>{
      const now = Date.now();
      if(now - S.lastTouchTime < S.dblTapBlockMs){ e.preventDefault(); /* –±–ª–æ–∫–∏—Ä—É–µ–º zoom */ }
      S.lastTouchTime = now;
    }, {passive:false});
  }

  // ----------------------- MainButton -----------------------
  function updateMainButton(){
    if(!S.tg) return;
    S.tg.MainButton.setParams({text:'–ó–∞–∫—Ä—ã—Ç—å'});
    S.tg.MainButton.show();
    S.tg.MainButton.onClick(closeApp);
  }

  // ----------------------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -----------------------
  function init(){
    applyThemeFromTelegram();
    bindTabs(); bindShop(); bindSandbox(); bindHistory(); bindFAQZoomFix();
    fillProfile(); updateOffline();
    on(window,'online',updateOffline); on(window,'offline',updateOffline);
    if(S.tg){ S.tg.ready(); S.tg.expand(); S.tg.BackButton.onClick(closeApp); }
  }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>
