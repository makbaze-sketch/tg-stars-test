<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark light"/>
  <title>Qleweta ‚Äî –ú–∏–Ω–∏‚Äë–∞–ø–ø</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
  /* =====================================================================
     QLEWETA MINI‚ÄëAPP ‚Äî 3 TABS (Status ¬∑ Sandbox ¬∑ FAQ)
     Production‚Äëready single file. Mobile‚Äëfirst, safe‚Äëarea aware, no i18n.
     ===================================================================== */
  :root{
    --bg:#070910; --card:#0c1018; --elev:#0f131c; --stroke:#1e2633;
    --text:#e9edf6; --muted:#9aa3b2; --accent:#7C5CFF; --accent2:#00D1FF;
    --ok:#73FFBF; --warn:#FFD166; --danger:#ff6b81; --radius:18px; --gap:12px;
    --shadow:0 12px 40px rgba(0,0,0,.36);
    --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
    --safe-left: env(safe-area-inset-left); --safe-right: env(safe-area-inset-right);
    --glow: 0 0 22px rgba(124,92,255,.38), 0 0 44px rgba(124,92,255,.18);
    --glow2: 0 0 18px rgba(0,209,255,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
  .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
  .header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(0,0,0,.88),rgba(0,0,0,.5));border-bottom:1px solid var(--stroke);padding:calc(10px + var(--safe-top)) var(--gap) 10px;backdrop-filter:blur(8px)}
  .header-wrap{max-width:980px;margin:0 auto;display:flex;align-items:center;gap:10px}
  .logo{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 0deg,var(--accent),var(--accent2),var(--accent));box-shadow:inset 0 0 0 2px rgba(255,255,255,.06)}
  .title{display:flex;flex-direction:column}
  .title h1{margin:0;font-size:16px}
  .title .sub{margin:2px 0 0;color:var(--muted);font-size:12px}

  .page{display:none}
  .page.active{display:block}
  .container{max-width:980px;margin:0 auto;padding:14px var(--gap) calc(96px + var(--safe-bottom))}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--stroke);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
  .grid{display:grid;gap:12px}
  .block{border:1px solid var(--stroke);border-radius:16px;background:var(--elev);padding:12px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:#0f1015aa}
  .badge.warn{border-color:rgba(255,209,102,.4);background:rgba(255,209,102,.08)}

  /* Sandbox */
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 10px}
  .chip{border:1px solid var(--stroke);background:#12151b;color:var(--text);border-radius:999px;padding:10px 12px;font-weight:800;cursor:pointer;min-height:40px}
  .chip.active{outline:2px solid rgba(124,92,255,.45);box-shadow:var(--glow)}
  .canvas-wrap{position:relative;border:1px solid #0d1420;border-radius:16px;overflow:hidden;background:#000}
  canvas{display:block;width:100%;height:380px}
  .scene-hint{position:absolute;right:10px;top:10px;font-size:12px;color:#6cf;background:rgba(8,20,40,.6);padding:6px 10px;border-radius:999px;border:1px solid #153055}

  /* FAQ */
  .qa{display:grid;gap:10px}
  .qa .q{border:1px solid var(--stroke);background:#11151e;border-radius:12px;padding:2px 10px}
  .qa .q summary{cursor:pointer;font-weight:800;min-height:44px;display:flex;align-items:center;touch-action:manipulation}
  .qa .q summary::-webkit-details-marker{display:none}
  .qa .q pre{white-space:pre-wrap;color:var(--muted);margin:8px 0 12px;font-size:14px}

  /* Bottom nav (3 tabs) */
  .tabs{position:sticky;bottom:0;left:0;right:0;z-index:20;background:rgba(0,0,0,.92);backdrop-filter:blur(8px);border-top:1px solid var(--stroke);padding:8px calc(var(--gap) + var(--safe-left)) calc(8px + var(--safe-bottom)) calc(var(--gap) + var(--safe-right))}
  .tabbar{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .tabbtn{border:1px solid var(--stroke);background:#12151b;color:var(--text);border-radius:12px;padding:8px 10px;text-align:center;cursor:pointer;font-weight:800;font-size:12px;display:flex;flex-direction:column;align-items:center;gap:6px}
  .tabbtn svg{width:20px;height:20px;opacity:.92}
  .tabbtn.active{outline:2px solid rgba(124,92,255,.45);box-shadow:var(--glow)}

  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(76px + var(--safe-bottom));z-index:50;display:none}
  .toast .bubble{background:rgba(20,24,33,.95);border:1px solid var(--stroke);color:var(--text);padding:10px 12px;border-radius:12px;box-shadow:var(--shadow);font-weight:800}
  .toast.show{display:block;animation:toast .2s ease-out}
  @keyframes toast{from{opacity:0;transform:translate(-50%,10px)}to{opacity:1;transform:translate(-50%,0)}}
  .appear{animation:appear .18s ease-out}
  @keyframes appear{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  @media (prefers-reduced-motion:reduce){.toast{animation:none}.appear{animation:none}}
  </style>
</head>
<body>
<div class="app" id="app">
  <header class="header">
    <div class="header-wrap">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <h1>Qleweta ‚Äî –ú–∏–Ω–∏‚Äë–∞–ø–ø</h1>
        <p class="sub">–ë–µ—Ç–∞ ¬∑ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —É–ª—É—á—à–∞–µ–º ¬∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Ö–æ–¥—è—Ç –≤—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏</p>
      </div>
    </div>
  </header>

  <main id="pages">
    <!-- ===== STATUS ===== -->
    <section class="page active" id="page-status" aria-labelledby="tab-status">
      <div class="container">
        <div class="card appear">
          <div class="badges" style="justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <span class="badge warn">Beta</span>
              <span class="badge">–í–µ—Ä—Å–∏—è: 3.0</span>
              <span class="badge" id="badgeClient">Client: ‚Äî</span>
            </div>
          </div>
          <div class="grid">
            <div class="block">
              <h3>–ö–æ—Ä–æ—Ç–∫–æ</h3>
              <p class="muted" style="margin:8px 0 0">–≠—Ç–æ –ø—É–±–ª–∏—á–Ω–∞—è –±–µ—Ç–∞. –í–æ–∑–º–æ–∂–Ω—ã –±–∞–≥–∏, –º–∏–∫—Ä–æ‚Äë–∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è. –ú—ã –Ω–µ –Ω–µ—Å–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã. –ò—Å–ø–æ–ª—å–∑—É—è –º–∏–Ω–∏‚Äë–∞–ø–ø, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å —ç—Ç–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.</p>
            </div>
            <div class="block">
              <h3>–ê–ø–¥–µ–π—Ç—ã</h3>
              <p class="muted" style="margin:8px 0 0">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏: –ø—Ä–∞–≤–∏–º –±–∞–≥–∏, —É–ª—É—á—à–∞–µ–º UX, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ü–µ–Ω—ã –≤ ¬´–ü–µ—Å–æ—á–Ω–∏—Ü–µ¬ª. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== SANDBOX ===== -->
    <section class="page" id="page-sandbox" aria-labelledby="tab-sandbox">
      <div class="container">
        <div class="card appear">
          <div class="block">
            <h3>–ü–µ—Å–æ—á–Ω–∏—Ü–∞ (7 —Ä–µ–∂–∏–º–æ–≤)</h3>
            <div class="chips" id="sceneChips">
              <button class="chip active" data-scene="eyes">üëÄ Eyes</button>
              <button class="chip" data-scene="parts">‚ú® Particles</button>
              <button class="chip" data-scene="kaleido">üî∂ Kaleidoscope</button>
              <button class="chip" data-scene="rings">‚≠ï Neon Rings</button>
              <button class="chip" data-scene="starfield">üåå Starfield</button>
              <button class="chip" data-scene="plasma">üåà Plasma</button>
              <button class="chip" data-scene="waves">„Ä∞Ô∏è Waves</button>
            </div>

            <!-- Canvas host -->
            <div class="canvas-wrap scene" id="sceneHost">
              <canvas id="canvas"></canvas>
              <div class="scene-hint">—Ç–∞–ø ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏—è/—Ü–≤–µ—Ç</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== FAQ ===== -->
    <section class="page" id="page-faq" aria-labelledby="tab-faq">
      <div class="container">
        <div class="card appear">
          <div class="grid">
            <div class="block">
              <h3>FAQ</h3>
              <div class="qa" id="faqList">
                <details class="q"><summary>–ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç–∞?</summary><pre>–ù–∞–∂–º–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—É—é ¬´–ù–∞–∑–∞–¥¬ª –≤ Telegram –∏–ª–∏ –∫–Ω–æ–ø–∫—É ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª (MainButton) ‚Äî –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞.</pre></details>
                <details class="q"><summary>–ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ ¬´–ø–æ–¥–ª–∞–≥–∏–≤–∞–µ—Ç¬ª?</summary><pre>–ú—ã –≤ –±–µ—Ç–µ. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ù–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø–ª–æ—Ç–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–æ—â–∞—é—Ç—Å—è.</pre></details>
                <details class="q"><summary>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç ¬´–ü–µ—Å–æ—á–Ω–∏—Ü–∞¬ª?</summary><pre>–≠—Ç–æ –Ω–∞–±–æ—Ä –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω –Ω–∞ Canvas. –ñ–º–∏—Ç–µ/–≤–æ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º ‚Äî –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏—è, –≤—Å–ø–ª–µ—Å–∫–∏, —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞.</pre></details>
                <details class="q"><summary>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∏—Å—á–µ–∑–ª–æ?</summary><pre>–î–∞. –í –º–æ–±–∏–ª—å–Ω–æ–º Safari –æ—Ç–∫–ª—é—á—ë–Ω dbl‚Äëtap zoom –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–∞–ø–æ–≤ –º—ã –¥–µ–ª–∞–µ–º –±–µ–∑ –∑—É–º–∞ (touch-action: manipulation).</pre></details>
                <details class="q"><summary>–ê–≤–∞—Ç–∞—Ä–∫–∏ –∏ –±–∞–ª–∞–Ω—Å?</summary><pre>–ê–≤–∞—Ç–∞—Ä–∫–∏ –Ω–µ —Ç—è–Ω–µ–º –ø–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏/CORS. –ë–∞–ª–∞–Ω—Å/–ø–ª–∞—Ç–µ–∂–∏ ‚Äî –≤ —Ç–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç–µ.</pre></details>
              </div>
            </div>
            <div class="block">
              <h3>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
              <div class="badges"><span class="badge" id="dbgClient">client: ‚Äî</span><span class="badge" id="dbgScheme">scheme: ‚Äî</span><span class="badge" id="dbgVer">webapp: ‚Äî</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <nav class="tabs" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="tabbar">
      <button class="tabbtn active" id="tab-status" data-page="page-status" aria-controls="page-status" aria-selected="true" title="–°—Ç–∞—Ç—É—Å">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12h16" stroke="currentColor" stroke-width="2"/><path d="M4 6h10" stroke="currentColor" stroke-width="2"/><path d="M4 18h12" stroke="currentColor" stroke-width="2"/></svg>
        <span>–°—Ç–∞—Ç—É—Å</span>
      </button>
      <button class="tabbtn" id="tab-sandbox" data-page="page-sandbox" aria-controls="page-sandbox" title="–ü–µ—Å–æ—á–Ω–∏—Ü–∞">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="2"/></svg>
        <span>–ü–µ—Å–æ—á–Ω–∏—Ü–∞</span>
      </button>
      <button class="tabbtn" id="tab-faq" data-page="page-faq" aria-controls="page-faq" title="FAQ">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 18h.01" stroke="currentColor" stroke-width="2"/><path d="M9 8a3 3 0 1 1 6 0c0 2-3 2-3 4" stroke="currentColor" stroke-width="2"/></svg>
        <span>FAQ</span>
      </button>
    </div>
  </nav>
</div>

<div class="toast" id="toast" role="status" aria-live="polite"><div class="bubble" id="toastText">‚Äî</div></div>

<script>
/* ====================================================================
   QLEWETA MINI‚ÄëAPP ‚Äî JS
   3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã, 7 —Å—Ü–µ–Ω. –°—Ç–∞—Ä—Ç/—Å—Ç–æ–ø —Å—Ü–µ–Ω –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏. Haptics, Theme.
   ==================================================================== */
(function(){
  'use strict';
  const S = {
    tg: (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null,
    page: 'page-status',
    haptics: true,
    scenes: {},
    activeScene: null,
    lastTouch: 0,
  };
  const $ = q=>document.querySelector(q); const $$=q=>Array.from(document.querySelectorAll(q));
  const on=(el,ev,fn,opt)=>el&&el.addEventListener(ev,fn,opt);
  function haptic(type='light'){ if(!S.haptics) return; try{ S.tg?.HapticFeedback?.impactOccurred(type);}catch(e){} }
  function toast(msg){ const box=$('#toast'); const t=$('#toastText'); if(!box||!t) return; t.textContent=msg; box.classList.add('show'); clearTimeout(toast._t); toast._t=setTimeout(()=>box.classList.remove('show'),1600);} 
  function applyTheme(){ if(!S.tg) return; const th=S.tg.themeParams||{}; const map={text_color:'--text',hint_color:'--muted',bg_color:'--bg',secondary_bg_color:'--card',link_color:'--accent2',button_color:'--accent'}; for(const k in map){ if(th[k]) document.documentElement.style.setProperty(map[k], th[k]); } $('#dbgScheme').textContent='scheme: '+(S.tg.colorScheme||'‚Äî'); $('#dbgVer').textContent='webapp: '+(S.tg.version||'‚Äî'); }
  function fillClient(){ const c=S.tg?.platform||'web'; $('#badgeClient').textContent='Client: '+c; $('#dbgClient').textContent='client: '+c; }
  function setPage(id){ if(S.page===id) return; $$('.page').forEach(p=>p.classList.toggle('active',p.id===id)); $$('.tabbtn').forEach(b=>b.classList.toggle('active', b.dataset.page===id)); S.page=id; if(id!=='page-sandbox'){ stopScene(); } try{window.scrollTo({top:0,behavior:'smooth'})}catch(e){} }
  function updateMainButton(){ if(!S.tg) return; S.tg.MainButton.setParams({text:'–ó–∞–∫—Ä—ã—Ç—å'}); S.tg.MainButton.show(); S.tg.MainButton.onClick(()=>{ try{S.tg.close()}catch(e){} }); }

  // ================== SCENE ENGINE ==================
  function stopScene(){ if(!S.activeScene) return; try{ S.activeScene.stop && S.activeScene.stop(); }catch(e){} S.activeScene=null; }
  function startScene(name){ const host=$('#canvas'); if(!host) return; if(S.activeScene && S.activeScene.name===name) return; stopScene(); if(!S.scenes[name]){ S.scenes[name]=SceneFactory(name, host); } S.activeScene=S.scenes[name]; S.activeScene.start(); }

  function SceneFactory(name, canvas){
    const ctx=canvas.getContext('2d'); let W=0,H=0,dpr=1,raf=0,started=false; let hue=200; let tapBoost=0; let mouse={x:0,y:0,active:false};
    function resize(){ const box=canvas.parentElement; W=box.clientWidth; H=380; dpr=Math.max(1,Math.min(2,devicePixelRatio||1)); canvas.width=W*dpr; canvas.height=H*dpr; canvas.style.width=W+'px'; canvas.style.height=H+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
    function bind(){ const r=canvas.getBoundingClientRect.bind(canvas); const set=(e)=>{ const b=r(); const p=('touches'in e)?e.touches[0]:e; mouse.x=p.clientX-b.left; mouse.y=p.clientY-b.top; mouse.active=true; }; const clr=()=>{mouse.active=false}; on(canvas,'mousemove',set); on(canvas,'mouseleave',clr); on(canvas,'touchstart',e=>{e.preventDefault(); set(e); tap();},{passive:false}); on(canvas,'touchmove',e=>{e.preventDefault(); set(e)},{passive:false}); on(window,'touchend',clr); on(canvas,'click',()=>{ tap(); }); }
    function tap(){ hue=(hue+60)%360; tapBoost=1; haptic('medium'); }

    // ====== EYES ======
    function startEyes(){ let eyes=[{x:W*0.38,y:H*0.5,r:62, iris:`hsl(${hue},90%,60%)`},{x:W*0.62,y:H*0.5,r:62, iris:`hsl(${(hue+40)%360},90%,60%)`}];
      const drawEye=e=>{ const {x,y,r,iris}=e; ctx.shadowBlur=18; ctx.shadowColor='rgba(180,200,255,.35)'; ctx.fillStyle='#0b0f18'; ctx.strokeStyle='#2a2f3a'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); ctx.stroke(); const dx=(mouse.x||W/2)-x, dy=(mouse.y||H/2)-y, dist=Math.hypot(dx,dy), lim=r*0.45; const px=x+(dist>lim?dx/dist*lim:dx), py=y+(dist>lim?dy/dist*lim:dy); ctx.shadowBlur=20; ctx.shadowColor=iris; ctx.fillStyle=iris; ctx.beginPath(); ctx.arc(px,py,r*0.36,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=10; ctx.shadowColor='#000'; ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(px,py,r*0.18,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0; ctx.fillStyle='rgba(255,255,255,.9)'; ctx.beginPath(); ctx.arc(px-r*0.1,py-r*0.1,r*0.06,0,Math.PI*2); ctx.fill(); };
      const loop=()=>{ ctx.clearRect(0,0,W,H); ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); eyes[0].x=W*0.38; eyes[0].y=H*0.5; eyes[1].x=W*0.62; eyes[1].y=H*0.5; eyes[0].iris=`hsl(${hue},90%,60%)`; eyes[1].iris=`hsl(${(hue+40)%360},90%,60%)`; drawEye(eyes[0]); drawEye(eyes[1]); raf=requestAnimationFrame(loop); }; loop(); return ()=>cancelAnimationFrame(raf); }

    // ====== PARTICLES ======
    function startParticles(){ const P=[]; const spawn=(x,y,n=16)=>{ for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2; const v=40+Math.random()*140; P.push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,r:2+Math.random()*3,h:(Math.random()*360)|0,life:2}); } }; spawn(W/2,H/2,28); let last=performance.now();
      const loop=(now)=>{ const dt=Math.min(40,now-last)/1000; last=now; ctx.fillStyle='rgba(0,0,0,0.25)'; ctx.fillRect(0,0,W,H); for(const p of P){ if(mouse.active){ const dx=mouse.x-p.x, dy=mouse.y-p.y, d=Math.hypot(dx,dy)+1; const f=120/d; p.vx+=dx/d*f*dt; p.vy+=dy/d*f*dt; } p.vx*=0.99; p.vy*=0.99; p.x+=p.vx*dt; p.y+=p.vy*dt; if(p.x<0||p.x>W)p.vx*=-1; if(p.y<0||p.y>H)p.vy*=-1; p.life-=dt*0.25; ctx.shadowBlur=14; ctx.shadowColor=`hsla(${p.h},100%,60%,.9)`; ctx.fillStyle=`hsla(${p.h},95%,60%,.9)`; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); } for(let i=P.length-1;i>=0;i--) if(P[i].life<=0) P.splice(i,1); raf=requestAnimationFrame(loop); };
      on(canvas,'click',e=>{ const r=canvas.getBoundingClientRect(); const x=e.clientX-r.left,y=e.clientY-r.top; spawn(x,y,20); }); raf=requestAnimationFrame(loop); return ()=>cancelAnimationFrame(raf); }

    // ====== KALEIDOSCOPE (glow + center burst) ======
    function startKaleido(){ let t=0; const N=12; // —Å–µ–∫—Ç–æ—Ä–æ–≤
      const loop=()=>{ t+=0.015 + tapBoost*0.05; tapBoost=Math.max(0,tapBoost-0.02); const cx=W/2, cy=H/2; ctx.clearRect(0,0,W,H); ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H);
        ctx.save(); ctx.translate(cx,cy);
        for(let i=0;i<N;i++){
          ctx.save(); ctx.rotate((i/N)*Math.PI*2 + t*0.2);
          const grd=ctx.createRadialGradient(0,0,10, 0,0,Math.max(W,H)*0.6);
          grd.addColorStop(0,`hsla(${(hue+i*10)%360},100%,60%,0.95)`);
          grd.addColorStop(0.4,`hsla(${(hue+80)%360},100%,50%,0.35)`);
          grd.addColorStop(1,'rgba(0,0,0,0)');
          ctx.fillStyle=grd; ctx.globalCompositeOperation='screen';
          ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,Math.max(W,H), 0, (Math.PI*2)/N); ctx.closePath(); ctx.fill();
          ctx.restore();
        }
        // —Ü–µ–Ω—Ç—Ä –≤—Å–ø–ª–µ—Å–∫–∞
        const pulse = 1 + Math.sin(t*4)*0.08 + tapBoost*0.6;
        ctx.shadowBlur=40; ctx.shadowColor=`hsla(${(hue+180)%360},100%,60%,.9)`; ctx.fillStyle=`hsla(${(hue+180)%360},100%,60%,.9)`;
        ctx.beginPath(); ctx.arc(cx,cy, 22*pulse, 0, Math.PI*2); ctx.fill(); ctx.shadowBlur=0; ctx.globalCompositeOperation='source-over';
        raf=requestAnimationFrame(loop);
      }; loop();
      on(canvas,'click',()=>{ hue=(hue+45)%360; tapBoost=1; });
      return ()=>cancelAnimationFrame(raf);
    }

    // ====== NEON RINGS ======
    function startRings(){ let t=0; const loop=()=>{ t+=0.02; ctx.clearRect(0,0,W,H); ctx.fillStyle='#05060a'; ctx.fillRect(0,0,W,H); const cx=W/2,cy=H/2; for(let i=0;i<8;i++){ const r=30+i*28 + Math.sin(t+i*.6)*6; ctx.lineWidth=2; ctx.shadowBlur=14; ctx.shadowColor=`hsla(${(hue+i*20)%360},100%,60%,.9)`; ctx.strokeStyle=`hsla(${(hue+i*20)%360},100%,60%,.9)`; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke(); } raf=requestAnimationFrame(loop); }; loop(); on(canvas,'click',()=>{ hue=(hue+30)%360; }); return ()=>cancelAnimationFrame(raf); }

    // ====== STARFIELD ======
    function startStarfield(){ const N=180; const stars=[]; for(let i=0;i<N;i++){ stars.push({x:(Math.random()-0.5)*W,y:(Math.random()-0.5)*H,z:Math.random()*W}); } const speed=60; function proj(s){ const f=200/(s.z+1); return {x:W/2+s.x*f, y:H/2+s.y*f}; }
      const loop=(now)=>{ ctx.fillStyle='rgba(0,0,10,0.4)'; ctx.fillRect(0,0,W,H); for(const s of stars){ s.z-=1.2; if(s.z<1){ s.x=(Math.random()-0.5)*W; s.y=(Math.random()-0.5)*H; s.z=W; } const p=proj(s); ctx.fillStyle=`hsla(${hue},100%,70%,.9)`; ctx.fillRect(p.x,p.y, 2,2); } raf=requestAnimationFrame(loop); }; raf=requestAnimationFrame(loop); on(canvas,'click',()=>{ hue=(hue+50)%360; }); return ()=>cancelAnimationFrame(raf); }

    // ====== PLASMA (—Å–∏–Ω—É—Å‚Äë–≥—Ä–∞–¥–∏–µ–Ω—Ç) ======
    function startPlasma(){ let t=0; const img=ctx.createImageData(W,H); const data=img.data; const loop=()=>{ t+=0.03; let i=0; for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ const v=Math.sin(x*0.02+t)+Math.sin(y*0.02-t)+Math.sin((x+y)*0.015); const c=(v+3)/6; const Hh=(hue+Math.floor(c*180))%360; const [r,g,b]=hsl2rgb(Hh/360,1,0.5); data[i++]=r; data[i++]=g; data[i++]=b; data[i++]=255; } } ctx.putImageData(img,0,0); raf=requestAnimationFrame(loop); }; loop(); on(canvas,'click',()=>{ hue=(hue+40)%360; }); return ()=>cancelAnimationFrame(raf); }

    // ====== WAVES ======
    function startWaves(){ let t=0; const loop=()=>{ t+=0.02; ctx.clearRect(0,0,W,H); const grd=ctx.createLinearGradient(0,0,0,H); grd.addColorStop(0,`hsl(${hue},80%,12%)`); grd.addColorStop(1,'#000'); ctx.fillStyle=grd; ctx.fillRect(0,0,W,H); ctx.lineWidth=2; for(let k=0;k<5;k++){ const amp=12+k*6; const spd=0.02+k*0.01; ctx.beginPath(); for(let x=0;x<=W;x+=6){ const y=H*0.5 + Math.sin(x*0.02 + t*(2+spd)+k)*amp; if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.strokeStyle=`hsla(${(hue+k*15)%360},100%,60%,.7)`; ctx.shadowBlur=12; ctx.shadowColor=ctx.strokeStyle; ctx.stroke(); } raf=requestAnimationFrame(loop); }; loop(); on(canvas,'click',()=>{ hue=(hue+35)%360; }); return ()=>cancelAnimationFrame(raf); }

    // ===== Helpers =====
    function hsl2rgb(h,s,l){ let r,g,b; if(s===0){ r=g=b=l; } else { const hue2rgb=(p,q,t)=>{ if(t<0) t+=1; if(t>1) t-=1; if(t<1/6) return p+(q-p)*6*t; if(t<1/2) return q; if(t<2/3) return p+(q-p)*(2/3 - t)*6; return p; }; const q=l<0.5? l*(1+s): l+s-l*s; const p=2*l-q; r=hue2rgb(p,q,h+1/3); g=hue2rgb(p,q,h); b=hue2rgb(p,q,h-1/3);} return [Math.round(r*255),Math.round(g*255),Math.round(b*255)]; }

    // public API
    return {
      name,
      start(){ if(started) return; started=true; resize(); bind(); window.addEventListener('resize',resize);
        let killer=()=>{}; switch(name){
          case 'eyes': killer=startEyes(); break;
          case 'parts': killer=startParticles(); break;
          case 'kaleido': killer=startKaleido(); break;
          case 'rings': killer=startRings(); break;
          case 'starfield': killer=startStarfield(); break;
          case 'plasma': killer=startPlasma(); break;
          case 'waves': killer=startWaves(); break;
        }
        this._stop=()=>{ cancelAnimationFrame(raf); killer&&killer(); };
      },
      stop(){ if(!started) return; started=false; try{ this._stop&&this._stop(); }catch(e){} window.removeEventListener('resize',resize); }
    };
  }

  // ================== INIT ==================
  function bindTabs(){ $$('.tabbtn').forEach(b=> on(b,'click',()=>{ setPage(b.dataset.page); haptic('light'); })); }
  function setPage(id){ setPage._=setPage._||((id)=>{}); setPage._(id); }
  setPage._=(id)=>{ if(S.page===id) return; $$('.page').forEach(p=>p.classList.toggle('active',p.id===id)); $$('.tabbtn').forEach(b=>b.classList.toggle('active', b.dataset.page===id)); S.page=id; if(id!=='page-sandbox'){ stopScene(); } try{window.scrollTo({top:0,behavior:'smooth'})}catch(e){} };

  function bindSandbox(){ const chips=$$('#sceneChips .chip'); chips.forEach(c=> on(c,'click',()=>{ chips.forEach(x=>x.classList.remove('active')); c.classList.add('active'); startScene(c.dataset.scene); haptic('light'); })); startScene('eyes'); }

  function startScene(name){ startScene._=startScene._||((name)=>{}); startScene._(name);} 
  startScene._=(name)=>{ const canvas=$('#canvas'); if(!canvas) return; if(S.activeScene && S.activeScene.name===name) return; if(S.activeScene) { try{S.activeScene.stop()}catch(e){} } if(!S.scenes[name]){ S.scenes[name]=SceneFactory(name, canvas);} S.activeScene=S.scenes[name]; S.activeScene.start(); };

  function stopScene(){ if(S.activeScene){ try{S.activeScene.stop()}catch(e){} S.activeScene=null; } }

  function attachNav(){ on($('#tab-status'),'click',()=>setPage('page-status')); on($('#tab-sandbox'),'click',()=>setPage('page-sandbox')); on($('#tab-faq'),'click',()=>setPage('page-faq')); }

  function init(){ applyTheme(); fillClient(); bindTabs(); attachNav(); bindSandbox(); updateMainButton(); if(S.tg){ S.tg.ready(); S.tg.expand(); S.tg.BackButton.onClick(()=>{ try{S.tg.close()}catch(e){} }); } }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>
